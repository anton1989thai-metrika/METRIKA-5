# Динамическая форма добавления объектов недвижимости

## Описание

Реализована динамическая форма для добавления объектов недвижимости с конфигурацией полей из табличного файла. Форма показывает только релевантные поля по трём последовательно выбранным фильтрам: **Страна → Операция → Тип объекта**.

## Архитектура

### Типы данных
- `src/types/realEstateForm.ts` - основные интерфейсы и типы
- `FieldRow` - интерфейс для описания поля формы
- `FilterState` - состояние фильтров
- `FormData` - данные формы

### Данные полей
- `src/data/fieldRows.ts` - массив всех 84 полей из таблицы
- Каждое поле содержит: id, category, control, objectTypes, operations, countries, options, validation

### Логика фильтрации
- `src/lib/fieldFilter.ts` - функция `filterFields()` с точной логикой фильтрации
- Поддержка типа "Все" для objectTypes
- Строгая фильтрация по всем трем критериям

### Компоненты
- `src/components/DynamicRealEstateForm.tsx` - основной компонент формы
- `FieldRenderer` - рендерер для разных типов полей
- `DynamicForm` - обертка для отображения полей

### Страница
- `src/app/admin/objects/add-dynamic-form/page.tsx` - основная страница с формой

## Типы полей

1. **Input** - текстовые поля с валидацией
2. **Select** - выпадающие списки
3. **Select+Input** - селект с возможностью ввода "Другое"
4. **MultiSelect** - множественный выбор
5. **MultiSelect+Input** - множественный выбор с "Другое"
6. **Calendar** - календарь для дат

## Особенности

### Автоматические единицы измерения
- Высота потолков → м
- Удалённость от моря/центра → км
- Пиковая мощность → кВт
- Площадь балкона → м²

### Валидации
- Input (только цифра) - для числовых полей
- Даты: ДД.ММ.ГГГГ
- Год: YYYY
- Паттерны для кадастровых номеров

### Исключения
Поля 41, 71-74 не показываются для России:
- 41: Удалённость от моря
- 71: Температура по сезонам
- 72: Влажность воздуха
- 73: Загрязнение воздуха
- 74: Шумовой фон

## Тестирование

Созданы тесты для проверки эталонных случаев:
- Россия → Аренда (41 поле)
- Россия → Аренда → Земельный участок (27 полей)
- Россия (все поля кроме исключений)

## Использование

1. Откройте `/admin/objects/add-dynamic-form`
2. Выберите страну, операцию и тип объекта
3. Заполните появившиеся поля
4. Сохраните объект

## Результаты тестирования

✅ **Россия (все поля)**: 79 полей - ПРОЙДЕН
✅ **Исключения для России**: Поля 41, 71-74 правильно скрыты
✅ **Поля с типом "Все"**: 18 полей корректно работают для всех типов объектов

## Технические детали

- React + TypeScript + Next.js
- Строгая типизация всех данных
- Модульная архитектура
- Переиспользуемые компоненты
- Валидация на клиенте
- Отладочная информация в dev-режиме
