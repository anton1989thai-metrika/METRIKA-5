# üìß –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–æ—á—Ç—ã –¥–ª—è METRIKA

## üéØ –¶–µ–ª—å

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –ø–æ—á—Ç–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –¥–æ–º–µ–Ω–∞ `metrika.direct` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ —Å–∞–π—Ç `–º–µ—Ç—Ä–∏–∫–∞.—Å–∞–π—Ç`.

---

## üìã –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ —Å–∞–π—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ—á—Ç–æ–π  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–∞–ø–∫–∏ (–í—Ö–æ–¥—è—â–∏–µ, –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ, –í–∞–∂–Ω—ã–µ, –°–ø–∞–º –∏ —Ç.–¥.)  
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∏—Å–µ–º  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∞–¥–º–∏–Ω–∞ (–ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —è—â–∏–∫–æ–≤)  

---

## üöÄ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –í–ê–ú (–ø–æ—à–∞–≥–æ–≤–æ)

### –®–ê–ì 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS —Å–µ—Ä–≤–µ—Ä–∞

#### 1.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞ –≤–∞—à–µ–º Mac –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS:

```bash
ssh root@72.62.72.196
```

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å root –æ—Ç –≤–∞—à–µ–≥–æ VPS (–µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ, —Å–±—Ä–æ—Å—å—Ç–µ –µ–≥–æ –≤ –ø–∞–Ω–µ–ª–∏ Hostinger).

#### 1.2 –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ SCP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–ù–∞ –≤–∞—à–µ–º Mac (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—è SSH —Å–µ—Å—Å–∏—é):

```bash
cd ~/Desktop/METRIKA-5-main
scp scripts/setup-mail-server-metrika.sh root@72.62.72.196:/root/
scp scripts/dns-config-metrika.txt root@72.62.72.196:/root/
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Git (–µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub)**

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ SSH —Å–µ—Å—Å–∏–∏):

```bash
cd /root
git clone [–≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π_–Ω–∞_github]
cd METRIKA-5-main
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å Hostinger**

1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Hostinger ‚Üí VPS ‚Üí File Manager
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `/root/scripts`
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã:
   - `scripts/setup-mail-server-metrika.sh`
   - `scripts/dns-config-metrika.txt`

---

### –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

#### 2.1 –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ SSH —Å–µ—Å—Å–∏–∏):

```bash
cd /root
chmod +x setup-mail-server-metrika.sh
sudo ./setup-mail-server-metrika.sh
```

#### 2.2 –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:

1. **IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞**: –ù–∞–∂–º–∏—Ç–µ Enter (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 72.62.72.196)
2. **–ü–∞—Ä–æ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—á—Ç–æ–≤–æ–≥–æ —è—â–∏–∫–∞** (10 —Ä–∞–∑):
   - derik@metrika.direct
   - savluk@metrika.direct
   - ionin@metrika.direct
   - manager@metrika.direct
   - smm@metrika.direct
   - info@metrika.direct
   - reg@metrika.direct
   - kadastr@metrika.direct
   - lawyer@metrika.direct
   - kan@metrika.direct

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ó–∞–ø–∏—à–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏! –û–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞.

#### 2.3 –ü–æ–ª—É—á–µ–Ω–∏–µ DKIM –∫–ª—é—á–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cat /etc/opendkim/keys/metrika.direct/mail.txt
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç** –∏–∑ –∫–∞–≤—ã—á–µ–∫ - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è DNS –∑–∞–ø–∏—Å–∏.

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
mail._domainkey	IN	TXT	( "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..." )
```

–ù—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –≤ –∫–∞–≤—ã—á–∫–∞—Ö: `v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...`

---

### –®–ê–ì 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

#### 3.1 –í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://nic.ru
2. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "DNS-–•–û–°–¢–ò–ù–ì" –∏–ª–∏ "–ú–û–ò –î–û–ú–ï–ù–´"
4. –ù–∞–π–¥–∏—Ç–µ –¥–æ–º–µ–Ω `metrika.direct`
5. –û—Ç–∫—Ä–æ–π—Ç–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –∑–∞–ø–∏—Å—è–º–∏

#### 3.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ A –∑–∞–ø–∏—Å–∏

1. –ù–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–¢–∏–ø**: A
   - **–ò–º—è**: mail
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: 72.62.72.196
   - **TTL**: 3600
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

#### 3.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ MX –∑–∞–ø–∏—Å–∏

1. –ù–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–¢–∏–ø**: MX
   - **–ò–º—è**: @ (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞)
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: mail.metrika.direct
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 10
   - **TTL**: 3600
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

#### 3.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ SPF –∑–∞–ø–∏—Å–∏

1. –ù–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–¢–∏–ø**: TXT
   - **–ò–º—è**: @
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: `v=spf1 mx a:mail.metrika.direct ip4:72.62.72.196 ~all`
   - **TTL**: 3600
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

#### 3.5 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DKIM –∑–∞–ø–∏—Å–∏

1. –ù–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–¢–∏–ø**: TXT
   - **–ò–º—è**: mail._domainkey
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: [–≤—Å—Ç–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —à–∞–≥–∞ 2.3, –ë–ï–ó –∫–∞–≤—ã—á–µ–∫]
     –ü—Ä–∏–º–µ—Ä: `v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...`
   - **TTL**: 3600
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

#### 3.6 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DMARC –∑–∞–ø–∏—Å–∏

1. –ù–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–¢–∏–ø**: TXT
   - **–ò–º—è**: _dmarc
   - **–ó–Ω–∞—á–µ–Ω–∏–µ**: `v=DMARC1; p=none; rua=mailto:dmarc@metrika.direct; ruf=mailto:dmarc@metrika.direct`
   - **TTL**: 3600
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

#### 3.7 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π DNS (PTR)

–≠—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É Hostinger:

1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Hostinger
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∏–∫–µ—Ç –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é DNS –∑–∞–ø–∏—Å—å:
   - IP: 72.62.72.196
   - –î–æ–º–µ–Ω: mail.metrika.direct

–ò–ª–∏ —á–µ—Ä–µ–∑ Live Chat –≤ –ø–∞–Ω–µ–ª–∏ Hostinger.

---

### –®–ê–ì 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –Ω–∞ —Å–∞–π—Ç–µ

#### 4.1 –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

–ù–∞ –≤–∞—à–µ–º Mac –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ):

```bash
cd ~/Desktop/METRIKA-5-main
nano .env
```

–ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–¥–∞.

#### 4.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ—á—Ç—ã

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏–∑ —à–∞–≥–∞ 2.2):

```env
# Email Configuration - IMAP (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∏—Å–µ–º)
IMAP_HOST="mail.metrika.direct"
IMAP_PORT="993"
IMAP_USER="info@metrika.direct"
IMAP_PASS="–ø–∞—Ä–æ–ª—å_–¥–ª—è_info@metrika.direct"

# Email Configuration - SMTP (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º)
SMTP_HOST="mail.metrika.direct"
SMTP_PORT="587"
SMTP_USER="info@metrika.direct"
SMTP_PASS="–ø–∞—Ä–æ–ª—å_–¥–ª—è_info@metrika.direct"
SMTP_FROM="info@metrika.direct"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π —è—â–∏–∫ (info, admin, reg –∏ —Ç.–¥.), —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —è—â–∏–∫–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

#### 4.3 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª (–≤ nano: Ctrl+O, Enter, Ctrl+X).

---

### –®–ê–ì 5: –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS

**–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è DNS –∑–∞–ø–∏—Å–µ–π –Ω—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å 5-60 –º–∏–Ω—É—Ç (–∏–Ω–æ–≥–¥–∞ –¥–æ 2 —á–∞—Å–æ–≤) –¥–ª—è –∏—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:

```bash
dig MX metrika.direct
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `mail.metrika.direct` - DNS –∑–∞–ø–∏—Å–∏ —Ä–∞–±–æ—Ç–∞—é—Ç.

---

### –®–ê–ì 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 6.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ SSH):

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tlnp | grep 25
netstat -tlnp | grep 993

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã 25 –∏ 993
```

#### 6.2 –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ mailutils –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
apt-get install -y mailutils

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ
echo "–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ" | mail -s "–¢–µ—Å—Ç" info@metrika.direct
```

#### 6.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç: http://localhost:3000/email
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
3. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø–∏—Å—å–º–∞ –≤ –ø–∞–ø–∫–µ "–í—Ö–æ–¥—è—â–∏–µ"

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π –≤ .env
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–µ—Ä (SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ: `systemctl status postfix dovecot`)
- –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏–ª–∏—Å—å –ª–∏ DNS –∑–∞–ø–∏—Å–∏

---

### –®–ê–ì 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### 7.1 –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ —Å–∞–π—Ç —Ç–∞–º –∂–µ)

```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
```
*/5 * * * * curl -X POST http://localhost:3000/api/emails/sync
```

#### 7.2 –ù–∞ –≤–∞—à–µ–º Mac (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ú–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∞ —Å–∞–π—Ç–µ.

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MX –∑–∞–ø–∏—Å–∏: `dig MX metrika.direct`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `tail -f /var/log/mail.log`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã 25, 587, 993, 995 –≤ –ø–∞–Ω–µ–ª–∏ Hostinger

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∏—Å—å–º–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–ø–∞–º

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SPF: `dig TXT metrika.direct | grep spf`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DKIM: `dig TXT mail._domainkey.metrika.direct`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é DNS (PTR) - —Å–º. —à–∞–≥ 3.7

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è IMAP

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env —Ñ–∞–π–ª–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Dovecot –∑–∞–ø—É—â–µ–Ω: `systemctl status dovecot`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/dovecot.log`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å - –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ –≤–≤–æ–¥–∏–ª–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `chmod +x setup-mail-server-metrika.sh`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo: `sudo ./setup-mail-server-metrika.sh`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã root: `whoami` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `root`)

---

## üìù –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —è—â–∏–∫–∏:

- derik@metrika.direct
- savluk@metrika.direct
- ionin@metrika.direct
- manager@metrika.direct
- smm@metrika.direct
- info@metrika.direct
- reg@metrika.direct
- kadastr@metrika.direct
- lawyer@metrika.direct
- kan@metrika.direct

---

## ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—á—Ç–æ–≤–æ–≥–æ —è—â–∏–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —è—â–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `newuser@metrika.direct`):

1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p /var/mail/vhosts/metrika.direct/newuser/{cur,new,tmp}
chown -R vmail:mail /var/mail/vhosts/metrika.direct/newuser

# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
useradd -r -s /sbin/nologin -d /var/mail/vhosts/metrika.direct/newuser -u 5001 -g mail newuser
echo "newuser:–ø–∞—Ä–æ–ª—å" | chpasswd

# –î–æ–±–∞–≤–∏—Ç—å –≤ Postfix
echo "newuser@metrika.direct metrika.direct/newuser/" >> /etc/postfix/virtual_mailbox
postmap /etc/postfix/virtual_mailbox

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Postfix
systemctl restart postfix
```

2. –î–æ–±–∞–≤—å—Ç–µ —è—â–∏–∫ –≤ –∫–æ–¥: –æ—Ç–∫—Ä–æ–π—Ç–µ `src/lib/auth-email.ts` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é `getAllMailboxes()`:

```typescript
'newuser@metrika.direct',
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–û—Ç–º–µ—Ç—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã:

- [ ] –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ VPS –ø–æ SSH
- [ ] –ó–∞–≥—Ä—É–∑–∏–ª —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –í–≤–µ–ª –ø–∞—Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö 10 —è—â–∏–∫–æ–≤
- [ ] –ü–æ–ª—É—á–∏–ª DKIM –∫–ª—é—á
- [ ] –î–æ–±–∞–≤–∏–ª A –∑–∞–ø–∏—Å—å –≤ DNS
- [ ] –î–æ–±–∞–≤–∏–ª MX –∑–∞–ø–∏—Å—å –≤ DNS
- [ ] –î–æ–±–∞–≤–∏–ª SPF –∑–∞–ø–∏—Å—å –≤ DNS
- [ ] –î–æ–±–∞–≤–∏–ª DKIM –∑–∞–ø–∏—Å—å –≤ DNS
- [ ] –î–æ–±–∞–≤–∏–ª DMARC –∑–∞–ø–∏—Å—å –≤ DNS
- [ ] –ó–∞–ø—Ä–æ—Å–∏–ª –Ω–∞—Å—Ç—Ä–æ–π–∫—É PTR –∑–∞–ø–∏—Å–∏ —É Hostinger
- [ ] –û–±–Ω–æ–≤–∏–ª .env —Ñ–∞–π–ª —Å –ø–∞—Ä–æ–ª—è–º–∏
- [ ] –ü–æ–¥–æ–∂–¥–∞–ª —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (5-60 –º–∏–Ω—É—Ç)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–∞ —Å–∞–π—Ç–µ
- [ ] –û—Ç–ø—Ä–∞–≤–∏–ª —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∏—Å—å–º–∞ –Ω–∞ —Å–∞–π—Ç–µ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤–∞—à–∞ –ø–æ—á—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—Ç—å. –ö–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç –ø–æ–¥ —Å–≤–æ–∏–º –ª–æ–≥–∏–Ω–æ–º –∏ —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é –ø–æ—á—Ç—É.

**–ê–¥–º–∏–Ω** —Å–º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —è—â–∏–∫–∏ —á–µ—Ä–µ–∑ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ—á—Ç—ã.

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `/var/log/mail.log`, `/var/log/dovecot.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `systemctl status postfix dovecot`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: https://mxtoolbox.com

